---
title: "Spatial Statistics Final Project"
author: "Brusco, Bianca; Wang, Hongting; Yang, Lingfeng"
date: "9/28/2018"
output: pdf_document
---

    ```{r setup, include = FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy = TRUE)
    library(ggplot2)
    library(lattice)
    library(spdep)
    library(RColorBrewer)
    library(classInt)
    library(rgdal)
    library(formatR)
    library(sm)
    library(dplyr)
    library(revgeo)
    
    #snippet to override r-chunk fonts.
    def.chunk.hook  <- knitr::knit_hooks$get("chunk")
    knitr::knit_hooks$set(chunk = function(x, options) {
       x <- def.chunk.hook(x, options)
       ifelse(options$size != "normalsize", paste0("\\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
    })
    ```

# Importing and Cleaning data
## Importing data
(1). NYC Stop & Frisk data
(2). Housing value panel data
```{r init-1,size="tiny",warning=FALSE,message=FALSE}
# Housing value
hvraw <- read.csv("data/Trimmed_home_value.csv", header = T)

# Stop & Frisk
load("data/sqf.RData")
#stops2013 <- subset(stops,year==2013)
#stops2013[1:3,c("date","precinct","suspected.crime","suspect.race","found.weapon")]

```

## Cleaning data
### Housing Value
```{r}
# select relevant date range for housing value, filter out other cities
hv <- hvraw %>% filter(City == "New York") %>% select(RegionName, CountyName, X2005.12:X2014.01) %>% arrange(RegionName)
```

### Stop & Frisk
```{r}
# filter out NAs for lon and lat, 1303 NAs and 47 "1900-12-31" for date, then select columns of interest, sorted in chronological order
sf <- stops %>% filter(lat > 40.2 & !is.na(lat)) %>% filter(date >= "2006-01-01" & date <= "2013-12-31") %>% select(year, date, time, precinct, suspected.crime, frisked, suspect.race, found.weapon, lat, lon) %>% arrange(date, time)
```


```{r}
# zip code shape file
zipraw <- readOGR("~/Desktop/A3SR/APSTA-GE-2015/Data/zip_code/ZIP_CODE_040114.shp")
nyc <- readOGR("~/Desktop/A3SR/APSTA-GE-2015/Data/Borough_Boundaries/geo_export_5e515234-1937-40b5-b942-1ef10ea3ea45.shp")

# change projection method to lon/lat
zipbd <-  spTransform(zipbd, CRS("+proj=longlat +ellps=WGS84 +no_defs"))

# test
plot(zipbd)
points(sf$lon[1:1000], sf$lat[1:1000], pch = ".", cex = 2, col = sf[1:10000, ]$suspect.race)
```


3. Of course, lat & lon (location) are given.  We make a graphical display:

```{r race-1, size = "tiny", warning = FALSE, message = FALSE} 
#load NYC map
nyc <- readOGR("~/Desktop/A3SR/APSTA-GE-2015/Data/Borough_Boundaries/geo_export_5e515234-1937-40b5-b942-1ef10ea3ea45.shp" )
stops2013clean <- stops2013[stops2013$lat>40.2 & !is.na(stops2013$lat),]
save(stops2013clean,file="Stop_Frisk/stops2013clean.RData")
png("sf_map.jpeg",width=1.25*480,height=480,bg="transparent")
plot(nyc)
with(stops2013clean,points(lon,lat,pch='.',col=stops2013clean$suspect.race))
dev.off()
```

#wwwww


